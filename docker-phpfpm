FROM php:5.6.16-fpm

#Installed by default: OpenSSL, PDO, Tokenizer, mysqlnd(Substitute for 'mysql')
#Installed manually: Mbstring, phppdo_mysql, mcrypt, zip(required for 'laravel/installer'), memcached
RUN apt-get update && apt-get -y install wget \
    && docker-php-ext-install mbstring \
    && docker-php-ext-install pdo_mysql \
	&& apt-get -y install libmcrypt-dev && docker-php-ext-install mcrypt \
	&& apt-get -y install zlib1g zlib1g-dev && docker-php-ext-install zip \
	&& apt-get -y install libmemcached-dev zlib1g-dev && pecl install memcached && echo 'extension = memcached.so' > /usr/local/etc/php/conf.d/memcached.ini \
	&& apt-get clean && rm -rf /var/lib/apt/list/*

COPY docker/docker-config/php-fpm.conf /usr/local/etc/
COPY docker/docker-config/php.ini-production /usr/local/etc/php/php.ini
COPY docker/docker-config/php.ini-common-delta /usr/local/etc/php/conf.d/common.ini

WORKDIR /usr/share/nginx/WEBAPP

COPY . /usr/share/nginx/WEBAPP
RUN chown -R www-data:www-data /usr/share/nginx/WEBAPP && chmod -R 755 /usr/share/nginx/WEBAPP

CMD ["php-fpm"]
